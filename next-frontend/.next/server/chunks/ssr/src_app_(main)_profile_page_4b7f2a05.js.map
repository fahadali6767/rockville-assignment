{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Rockville-test/next-frontend/src/app/%28main%29/profile/page.js"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\n\r\nexport default function ProfilePage() {\r\n  const [name, setName] = useState(\"\");\r\n  const [dateOfBirth, setDateOfBirth] = useState(\"\");\r\n  const [address, setAddress] = useState(\"\");\r\n  const [profileImage, setProfileImage] = useState(\"\"); // To store the URL of the profile image\r\n  const [selectedImageFile, setSelectedImageFile] = useState(null); // To store the file object for upload\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchUserProfile = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n        const userDataString = localStorage.getItem(\"userData\");\r\n        const userData = userDataString ? JSON.parse(userDataString) : null;\r\n\r\n        if (!token || !userData || !userData._id) {\r\n          setError(\"Authentication information missing. Please log in again.\");\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const response = await fetch(\r\n          `${process.env.NEXT_PUBLIC_API_BASE_URL}/user/${userData._id}`,\r\n          {\r\n            method: \"GET\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n            },\r\n          }\r\n        );\r\n\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          throw new Error(errorData.message || \"Failed to fetch user profile\");\r\n        }\r\n\r\n        const userProfile = await response.json();\r\n        setName(userProfile.name || \"\");\r\n        setDateOfBirth(userProfile.dateOfBirth || \"\");\r\n        setAddress(userProfile.address || \"\");\r\n        setProfileImage(userProfile.profileImage || \"\");\r\n      } catch (err) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchUserProfile();\r\n  }, []);\r\n\r\n  const handleImageChange = (event) => {\r\n    if (event.target.files && event.target.files[0]) {\r\n      setSelectedImageFile(event.target.files[0]);\r\n      setProfileImage(URL.createObjectURL(event.target.files[0])); // Show a preview\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const userDataString = localStorage.getItem(\"userData\");\r\n      const userData = userDataString ? JSON.parse(userDataString) : null;\r\n\r\n      if (!token || !userData || !userData._id) {\r\n        alert(\"Authentication information missing. Please log in again.\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      let imageUrlToSave = profileImage; // Default to existing image\r\n\r\n      if (selectedImageFile) {\r\n        const formData = new FormData();\r\n        formData.append(\"file\", selectedImageFile);\r\n\r\n        const uploadResponse = await fetch(\r\n          `${process.env.NEXT_PUBLIC_API_BASE_URL}/media/upload`,\r\n          {\r\n            method: \"POST\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n              // \"Content-Type\": \"multipart/form-data\", // This header is automatically set by fetch when using FormData\r\n            },\r\n            body: formData,\r\n          }\r\n        );\r\n\r\n        if (!uploadResponse.ok) {\r\n          const errorData = await uploadResponse.json();\r\n          throw new Error(errorData.message || \"Failed to upload image\");\r\n        }\r\n\r\n        const uploadResult = await uploadResponse.json();\r\n        const filename = uploadResult.filename; // Assuming the API returns a filename\r\n        imageUrlToSave = `${process.env.NEXT_PUBLIC_API_BASE_URL}/uploads/${filename}`;\r\n      }\r\n\r\n      const updateResponse = await fetch(\r\n        `${process.env.NEXT_PUBLIC_API_BASE_URL}/user`,\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          body: JSON.stringify({\r\n            name: name,\r\n            dateOfBirth: dateOfBirth,\r\n            address: address,\r\n            profileImage: imageUrlToSave,\r\n          }),\r\n        }\r\n      );\r\n\r\n      if (!updateResponse.ok) {\r\n        const errorData = await updateResponse.json();\r\n        throw new Error(errorData.message || \"Failed to update profile\");\r\n      }\r\n\r\n      alert(\"Profile updated successfully!\");\r\n      // Optionally, update localStorage.userData if the API returns updated user data\r\n    } catch (err) {\r\n      setError(err.message);\r\n      alert(`Error updating profile: ${err.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Loading profile...</p>;\r\n  if (error) return <p>Error: {error}</p>;\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n      <div className=\"bg-white p-8 rounded-lg shadow-md w-full max-w-md\">\r\n        <h2 className=\"text-2xl font-bold mb-6 text-center\">Edit Profile</h2>\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {/* Name */}\r\n          <div>\r\n            <label\r\n              htmlFor=\"name\"\r\n              className=\"block text-sm font-medium text-gray-700\"\r\n            >\r\n              Name\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"name\"\r\n              value={name}\r\n              onChange={(e) => setName(e.target.value)}\r\n              className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\r\n            />\r\n          </div>\r\n\r\n          {/* Profile Image */}\r\n          <div>\r\n            <label\r\n              htmlFor=\"profileImage\"\r\n              className=\"block text-sm font-medium text-gray-700\"\r\n            >\r\n              Profile Image\r\n            </label>\r\n            <input\r\n              type=\"file\"\r\n              id=\"profileImage\"\r\n              accept=\"image/*\"\r\n              onChange={handleImageChange}\r\n              className=\"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100\"\r\n            />\r\n            {profileImage && (\r\n              <img\r\n                src={profileImage}\r\n                alt=\"Profile\"\r\n                className=\"mt-4 w-32 h-32 rounded-full object-cover mx-auto\"\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {/* Date of Birth */}\r\n          <div>\r\n            <label\r\n              htmlFor=\"dateOfBirth\"\r\n              className=\"block text-sm font-medium text-gray-700\"\r\n            >\r\n              Date of Birth\r\n            </label>\r\n            <input\r\n              type=\"date\"\r\n              id=\"dateOfBirth\"\r\n              value={dateOfBirth}\r\n              onChange={(e) => setDateOfBirth(e.target.value)}\r\n              className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\r\n            />\r\n          </div>\r\n\r\n          {/* Address */}\r\n          <div>\r\n            <label\r\n              htmlFor=\"address\"\r\n              className=\"block text-sm font-medium text-gray-700\"\r\n            >\r\n              Address\r\n            </label>\r\n            <textarea\r\n              id=\"address\"\r\n              rows=\"3\"\r\n              value={address}\r\n              onChange={(e) => setAddress(e.target.value)}\r\n              className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\r\n            ></textarea>\r\n          </div>\r\n\r\n          {/* Submit Button */}\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\r\n            disabled={loading}\r\n          >\r\n            {loading ? \"Updating...\" : \"Update Profile\"}\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}